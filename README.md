# Парсер интернет магазина Бетховен

## Установка

- ```git clone git@github.com:dim272/bwn_parser.git```
- ```python -m venv venv```
- ```pip install -r requirements. txt```

## Настройка

Для работы парсера необходимо заполнить конфигурационный файл **configs.py**:

- **THREADS** - количество потоков. 
  - Пример: 5
- **CITY_NAME** - название города. 
  - Пример: "Москва"
- **STORE_ADDRESS** - адрес торговой точки. Если оставить пустым, будут собраны продукты из всех магазинов города.
  - Пример: "Головинское ш., 5к1"
  - Пример: "" - соберутся все магазины города.
- **CATEGORY_NAMES** - список интересующих категорий. Будут собраны только те продукты в которых найдутся все категории из списка.
  - Пример: ['Для собак', 'Амуниция', 'Ошейники'] - Соберутся только ошейники для собак.
  - Пример: ['Ошейники'] - Соберутся все ошейники.

## Прокси
Для работы парсера необходимо предоставить список прокси в формате:

```username:password@host:port```

Прокси необходимо разделить знаком переноса строки "\n" (или просто записать построчно) и сохранить в файл **misc/proxies.txt**.

## Запуск

Парсера запускается в файле **main.py** или командой в терминале: ```python main.py```

## Принцип работы парсера

Парсер работает только с API сайта.

Порядок запросов:

1. Производит поиск информации по названию города. Получаем city_id;
2. Устанавливаем в настройки сервера city_id через пост запрос;
3. Устанавливаем в куки сессии: ```BETHOWEN_GEO_TOWN_ID={city_id};```;
4. Производится проверка наличия в городе магазинов;
5. Проверяется наличие товаров через запрос к каталогу;
6. Собирается весь каталог продуктов, доступный в данном городе;
7. Проходим по каждому продукту и находим информацию об офферах;
8. Делаем реквест к каждому офферу;
9. Собираем информацию о продукте если верны оба значения:
   - в ```offer_store_amount``` находится адрес искомого магазина;
   - в ```categories_chain``` находятся искомые категории;
10. Сохраняем найденную информацию в файл **.csv**.


### Вопрос к составителям ТЗ: 
https://docs.google.com/document/d/1XwCP0pGdh40T_wZn3N6gsMNjObnuJDcBrO-qaazR404/edit?usp=sharing
